name: í”„ë¡ íŠ¸ì—”ë“œ CI

on:
  push:
    branches:
      - dev
    paths: frontend/**
  pull_request:
    branches:
      - dev
    paths: frontend/**

env:
  DOCKER_DIRECTORY: './frontend/docker'

jobs:
  check_path_changes:
    name: ê²½ë¡œ í™•ì¸
    runs-on: ubuntu-latest
    permissions:
      pull-requests: read
    outputs:
      frontend: ${{ steps.changes.outputs.frontend }}
    steps:
      - uses: actions/checkout@v4
      - uses: dorny/paths-filter@v3
        id: changes
        with:
          filters: |
            frontend:
              - 'frontend/**'

  frontend_ci:
    name: í”„ë¡ íŠ¸ì—”ë“œ í†µí•©
    runs-on: ubuntu-latest
    needs: check_path_changes
    if: ${{ needs.check_path_changes.outputs.frontend == 'true' }}
    permissions:
      contents: read
      packages: write
      actions: write

    steps:
      - name: ë ˆí¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.ref }}
        
      - name: NodeJS ì„¸íŒ…
        uses: actions/setup-node@v4
        with: 
          node-version: '20'
      
      - name: ì˜ì¡´ê´€ê³„ ì„¤ì¹˜
        run: |
          cd frontend
          npm install
      
      - name: npm ë¹Œë“œ
        continue-on-error: true
        id: npm_run_build
        run: |
          pwd
          cd frontend
          npm run build
      

  fe_ci_success_slack_message:
    name: í”„ë¡ íŠ¸ì—”ë“œ í†µí•© ìŠ¬ë™ë©”ì„¸ì§€ ì „ì†¡
    runs-on: ubuntu-latest
    needs: frontend_ci
    if: success()
    steps:
      - uses: slackapi/slack-github-action@v1.26.0
        with: 
          channel-id: ${{ secrets.SLACK_CICD_CHANNEL_ID }}
          payload: |
            {
              "blocks": [
                {
                  "type": "rich_text",
                  "elements": [
                    {
                      "type": "rich_text_section",
                      "elements": [
                        {
                          "type": "text",
                          "text": "í”„ë¡ íŠ¸ì—”ë“œ CI ì•ˆë‚´ ",
                          "style": {
                            "bold": true
                          }
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "divider"
                },
                {
                  "type": "section",
                  "text": {
                    "type": "plain_text",
                    "text": "ğŸŸ¢ í†µí•© ì„±ê³µ",
                    "emoji": true
                  }
                }
              ]
            }
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_CICD_BOT_TOKEN }}
        





